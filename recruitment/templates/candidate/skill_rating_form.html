{% load i18n %}

<div class="oh-modal__dialog-header">
    <h5 class="oh-modal__dialog-title" id="skillRatingModalLabel">
        {% trans "Skill Rating for" %} {{candidate.name}}
    </h5>
    <button class="oh-modal__close" aria-label="Close">
        <ion-icon name="close-outline"></ion-icon>
    </button>
</div>

<div class="oh-modal__dialog-body">
    <!-- Context Information -->
    {% if recruitment or stage %}
    <div class="alert alert-info mb-3">
        <strong>{% trans "Rating Context:" %}</strong>
        {% if recruitment %}{% trans "Recruitment:" %} {{ recruitment.title }}{% endif %}
        {% if recruitment and stage %} | {% endif %}
        {% if stage %}{% trans "Stage:" %} {{ stage.stage }}{% endif %}
    </div>
    {% endif %}
    
    <form hx-post="{% url 'candidate-skill-rating' cand_id %}?recruitment_id={{recruitment.id|default:''}}&stage_id={{stage.id|default:''}}" hx-target="#createTarget" hx-swap="innerHTML">
        {% csrf_token %}
        
        <!-- Technical Skills Section -->
        {% if technical_skills %}
        <div class="mb-4">
            <h6 class="text-primary mb-3">{% trans "Technical Skills" %}</h6>
            <div class="row">
                {% for skill in technical_skills %}
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <label class="form-label me-3 mb-0" style="min-width: 120px;">{{ skill.title }}</label>
                        <input type="number" 
                               name="technical_rating_{{ skill.id }}" 
                               class="form-control" 
                               min="0.0" 
                               max="5.0" 
                               step="0.1" 
                               placeholder="0.0 - 5.0"
                               style="max-width: 100px;"
                               value="{% for rating in existing_ratings %}{% if rating.skill_name == skill.title and rating.skill_category == 'technical' %}{{ rating.rating }}{% endif %}{% endfor %}">
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Non-Technical Skills Section -->
        {% if non_technical_skills %}
        <div class="mb-4">
            <h6 class="text-primary mb-3">{% trans "Non-Technical Skills" %}</h6>
            <div class="row">
                {% for skill in non_technical_skills %}
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <label class="form-label me-3 mb-0" style="min-width: 120px;">{{ skill.title }}</label>
                        <input type="number" 
                               name="non_technical_rating_{{ skill.id }}" 
                               class="form-control" 
                               min="0.0" 
                               max="5.0" 
                               step="0.1" 
                               placeholder="0.0 - 5.0"
                               style="max-width: 100px;"
                               value="{% for rating in existing_ratings %}{% if rating.skill_name == skill.title and rating.skill_category == 'non_technical' %}{{ rating.rating }}{% endif %}{% endfor %}">
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Custom Skill Rating -->
        <div class="mb-4">
            <h6 class="text-primary mb-3">{% trans "Add Custom Skill Rating" %}</h6>
            <div class="row">
                {% if not recruitment %}
                <div class="col-md-6 mb-3">
                    <label class="form-label">{% trans "Recruitment" %}</label>
                    {{ form.recruitment }}
                    {{ form.recruitment.errors }}
                </div>
                {% endif %}
                {% if not stage %}
                <div class="col-md-6 mb-3">
                    <label class="form-label">{% trans "Stage" %}</label>
                    {{ form.stage }}
                    {{ form.stage.errors }}
                </div>
                {% endif %}
                <div class="col-md-6 mb-3">
                    <label class="form-label">{% trans "Skill Name" %}</label>
                    {{ form.skill_name }}
                    {{ form.skill_name.errors }}
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">{% trans "Skill Category" %}</label>
                    {{ form.skill_category }}
                    {{ form.skill_category.errors }}
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">{% trans "Rating (0.0 - 5.0)" %}</label>
                    {{ form.rating }}
                    {{ form.rating.errors }}
                </div>
            </div>
        </div>
        
        <!-- Notes Section -->
        <div class="mb-4">
            <h6 class="text-primary mb-3">{% trans "Notes" %}</h6>
            <div class="row">
                <div class="col-12">
                    <label class="form-label">{% trans "Additional Notes" %}</label>
                    {{ form.notes }}
                    {{ form.notes.errors }}
                </div>
            </div>
        </div>
        
        <!-- Submit Button -->
        <div class="d-flex flex-row-reverse">
            <button type="submit" class="oh-btn oh-btn--secondary mt-2 mr-0 pl-4 pr-5 oh-btn--w-100-resp">
                {% trans 'Save Ratings' %}
            </button>
        </div>
    </form>
</div>

<script>
    // Simple form submission - let HTMX handle it
    document.querySelector('form').addEventListener('submit', function(e) {
        // Let the form submit normally with HTMX
        // HTMX will handle the submission and reload
    });
</script> 